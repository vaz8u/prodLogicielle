name: Exemple de workflow PostgreSQL

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres:10.8
        env:
          POSTGRES_USER: admin
          POSTGRES_PASSWORD: admin
          POSTGRES_DB: MySurvey
        ports:
          - 5432:5432
        options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      - name: Set up JDK 21
        uses: actions/setup-java@v3
        with:
          java-version: 21
          distribution: 'zulu' # Alternative distribution options are available.

      - name: Build with Maven
        run: mvn -B package --file pom.xml

      - name: Run Project
        run : java -jar target/*.jar &

      - name: Attendre que l'application soit lanc√©e
        uses: kamilchodola/wait-for-workflow-action@1.1.0
        with:
          GITHUB_TOKEN: ${{ secrets.ACCES_READ_WRITE }}
          workflow_id: 'mutation.yml'
          max_wait_minutes: '1'
          interval: '5'
          timeout: '60'
          org_name: 'vaz8u'
          repo_name: 'prodLogicielle'
          ref: '${{ github.ref }}'

      - name: Mutations
        run: mvn clean test org.pitest:pitest-maven:mutationCoverage


